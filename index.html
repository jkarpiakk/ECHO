<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formularz ECHO CLS</title>
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2/dist/tailwind.min.css" rel="stylesheet">
  <!-- PapaParse for CSV export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <!-- docx.js UMD Bundle for DOCX export -->
  <script src="https://cdn.jsdelivr.net/npm/docx@7.3.0/build/docx.umd.js"></script>
</head>
<body class="bg-gray-50">
  <div class="max-w-4xl mx-auto p-6 bg-white shadow-md mt-10 rounded-lg">
    <header class="flex items-center mb-6">
      <img src="logo_szpitala.png" alt="Logo kliniki" class="h-16 mr-4">
      <div>
        <h1 class="text-xl font-bold">Klinika Kardiologii z Pododdziałem Ostrych Zespołów Wieńcowych</h1>
        <p>Kliniczny Szpital Wojewódzki Nr 2 im. Św. Jadwigi Królowej w Rzeszowie</p>
        <p>ul. Lwowska 60, 35‑301 Rzeszów</p>
      </div>
    </header>
    <h2 class="text-lg font-semibold mb-4">Formularz badania echokardiograficznego</h2>
    <form id="echoForm" class="space-y-6">
      <!-- Sekcje formularza -->
      <fieldset class="border p-4 rounded">
        <legend class="font-medium">1. Dane pacjenta</legend>
        <div class="grid grid-cols-2 gap-4 mt-2">
          <label class="block text-sm">Imię i nazwisko<br><input name="patientName" type="text" class="w-full border rounded p-2"/></label>
          <label class="block text-sm">Nr badania / ID<br><input name="patientID" type="text" class="w-full border rounded p-2"/></label>
          <label class="block text-sm">Data badania<br><input name="examDate" type="date" class="w-full border rounded p-2"/></label>
          <label class="block text-sm">Operator / lekarz<br><input name="operator" type="text" class="w-full border rounded p-2"/></label>
        </div>
      </fieldset>
      <fieldset class="border p-4 rounded">
        <legend class="font-medium">2. Wymiary jam serca (M-mode / 2D)</legend>
        <div class="grid grid-cols-3 gap-4 mt-2" id="dimContainer"></div>
      </fieldset>
      <fieldset class="border p-4 rounded">
        <legend class="font-medium">3. Średnice pni naczyniowych</legend>
        <div class="grid grid-cols-3 gap-4 mt-2" id="vesContainer"></div>
      </fieldset>
      <fieldset class="border p-4 rounded">
        <legend class="font-medium">4. Objętości i funkcja skurczowa</legend>
        <div class="space-y-2 mt-2">
          <label class="block text-sm">EF [%]<br><input name="EF" type="number" step="any" class="w-32 border rounded p-2"/></label>
          <label class="block text-sm">Metoda<br><select name="EFmethod" class="w-32 border rounded p-2"><option value="">-</option><option>Simpson</option><option>Teichholz</option><option>Inna</option></select></label>
          <label class="block text-sm">EDV [ml]<br><input name="EDV" type="number" step="any" class="w-32 border rounded p-2"/></label>
          <label class="block text-sm">ESV [ml]<br><input name="ESV" type="number" step="any" class="w-32 border rounded p-2"/></label>
        </div>
      </fieldset>
      <fieldset class="border p-4 rounded">
        <legend class="font-medium">5. Odcinkowe zaburzenia kurczliwości</legend>
        <label class="inline-flex items-center"><input type="checkbox" name="segmentalPresent" class="form-checkbox"/><span class="ml-2">Obecne</span></label>
        <label class="block text-sm mt-2">Opis segmentów/uwagi<br><textarea name="segmentalDescription" class="w-full border rounded p-2" rows="3"></textarea></label>
      </fieldset>
      <fieldset class="border p-4 rounded">
        <legend class="font-medium">6. TAPSE</legend>
        <label class="block text-sm">Wartość [mm]<br><input name="TAPSE" type="number" step="any" class="w-32 border rounded p-2"/></label>
      </fieldset>
      <fieldset class="border p-4 rounded">
        <legend class="font-medium">7. Ocena zastawek</legend>
        <!-- 7.1 Mitralna -->
        <div class="mt-2">
          <h3 class="font-semibold">7.1 Zastawka mitralna</h3>
          <div class="grid grid-cols-3 gap-4 mt-2">
            <label class="block text-sm">Regurgitacja<br><select name="mitralRegurg" class="w-full border rounded p-2"><option value="">-</option><option>łagodna</option><option>umiarkowana</option><option>ciężka</option></select></label>
            <label class="block text-sm">VC [cm²]<br><input name="mitralVC" type="number" step="any" class="w-full border rounded p-2"/></label>
            <label class="block text-sm">PISA [mm]<br><input name="mitralPISA" type="number" step="any" class="w-full border rounded p-2"/></label>
          </div>
          <div class="grid grid-cols-3 gap-4 mt-2">
            <label class="block text-sm">ERO [cm²]<br><input name="mitralERO" type="number" step="any" class="w-full border rounded p-2"/></label>
            <label class="block text-sm">E/A ratio<br><input name="mitralEAratio" type="text" class="w-full border rounded p-2"/></label>
            <label class="block text-sm">MxPG [mmHg]<br><input name="mitralMxPG" type="number" step="any" class="w-full border rounded p-2"/></label>
          </div>
          <label class="block text-sm mt-2">MnPG [mmHg]<br><input name="mitralMnPG" type="number" step="any" class="w-full border rounded p-2"/></label>
        </div>
        <!-- 7.2 Aortalna -->
        <div class="mt-6">
          <h3 class="font-semibold">7.2 Zastawka aortalna</h3>
          <div class="grid grid-cols-2 gap-4 mt-2">
            <label class="block text-sm">Morfologia<br><select name="aorticMorphology" class="w-full border rounded p-2"><option value="">-</option><option>trójpłatkowa</option><option>dwupłatkowa</option></select></label>
            <label class="block text-sm">Stenoza/Regurgitacja<br><select name="aorticRegSten" class="w-full border rounded p-2"><option value="">-</option><option>łagodna</option><option>umiarkowana</option><option>ciężka</option></select></label>
          </div>
          <div class="grid grid-cols-4 gap-4 mt-2">
            <label class="block text-sm">VC [cm²]<br><input name="aorticVC" type="number" step="any" class="w-full border rounded p-2"/></label>
            <label class="block text-sm">PHT [ms]<br><input name="aorticPHT" type="number" step="any" class="w-full border rounded p-2"/></label>
            <label class="block text-sm">Vmax [m/s]<br><input name="aorticVmax" type="number" step="any" class="w-full border rounded p-2"/></label>
            <label class="block text-sm">Pmax [mmHg]<br><input name="aorticPmax" type="number" step="any" class="w-full border rounded p-2"/></label>
          </div>
        </div>
        <!-- 7.3 Trójdzielna -->
        <div class="mt-6">
          <h3 class="font-semibold">7.3 Zastawka trójdzielna</h3>
          <div class="grid grid-cols-2 gap-4 mt-2">
            <label class="block text-sm">Regurgitacja<br><select name="tricuspidRegurg" class="w-full border rounded p-2"><option value="">-</option><option>łagodna</option><option>umiarkowana</option><option>ciężka</option></select></label>
            <label class="block text-sm">TR Vmax [m/s]<br><input name="tricuspidVmax" type="number" step="any" class="w-full border rounded p-2"/></label>
          </div>
          <label class="block text-sm mt-2">Pmax [mmHg]<br><input name="tricuspidPmax" type="number" step="any" class="w-full border rounded p-2"/></label>
        </div>
      </fieldset>
      <fieldset class="border p-4 rounded">
        <legend class="font-medium">8. Osierdzie</legend>
        <label class="inline-flex items-center"><input type="checkbox" name="pericardEffusion" class="form-checkbox"/><span class="ml-2">Płyn w osierdziu</span></label>
        <label class="block text-sm mt-2">Uwagi<br><textarea name="pericardNotes" class="w-full border rounded p-2" rows="2"></textarea></label>
      </fieldset>
      <fieldset class="border p-4 rounded">
        <legend class="font-medium">9. Uwagi końcowe i rekomendacje</legend>
        <textarea name="remarks" class="w-full border rounded p-2" rows="3"></textarea>
      </fieldset>
      <div class="flex space-x-4 mt-6">
        <button type="button" id="exportCsv" class="px-4 py-2 bg-blue-600 text-white rounded">Eksportuj CSV</button>
        <button type="button" id="exportDocx" class="px-4 py-2 bg-green-600 text-white rounded">Eksportuj DOCX</button>
      </div>
    </form>
  </div>

  <script>
    // Field definitions for CSV and DOCX
    const fieldDefs = [
      { key: 'patientName', label: 'Imię i nazwisko' },
      { key: 'patientID', label: 'Nr badania / ID' },
      { key: 'examDate', label: 'Data badania' },
      { key: 'operator', label: 'Operator / lekarz' },
      { key: 'LVIDd', label: 'LV (LVIDd/s)' },
      { key: 'IVSd', label: 'IVSd' },
      { key: 'PWd', label: 'PWd' },
      { key: 'LA', label: 'LA' },
      { key: 'LAVI', label: 'LAVI' },
      { key: 'RAA', label: 'RAA' },
      { key: 'RV', label: 'RV' },
      { key: 'OpuszkaAorty', label: 'Opuszka aorty' },
      { key: 'AortaWstepujaca', label: 'Aorta wstępująca' },
      { key: 'MPA', label: 'Pień płucny (MPA)' },
      { key: 'EF', label: 'EF' },
      { key: 'EFmethod', label: 'Metoda EF' },
      { key: 'EDV', label: 'EDV' },
      { key: 'ESV', label: 'ESV' },
      { key: 'segmentalPresent', label: 'Odcinkowe zaburzenia obecne' },
      { key: 'segmentalDescription', label: 'Opis odcinkowych zaburzeń' },
      { key: 'TAPSE', label: 'TAPSE' },
      { key: 'mitralRegurg', label: 'Mitral regurgitacja' },
      { key: 'mitralVC', label: 'Mitral VC' },
      { key: 'mitralPISA', label: 'Mitral PISA' },
      { key: 'mitralERO', label: 'Mitral ERO' },
      { key: 'mitralEAratio', label: 'Mitral E/A ratio' },
      { key: 'mitralMxPG', label: 'Mitral MxPG' },
      { key: 'mitralMnPG', label: 'Mitral MnPG' },
      { key: 'aorticMorphology', label: 'Aortal morfologia' },
      { key: 'aorticRegSten', label: 'Aortal stenoza/</textarea></details> missing due to length retreated
